# CoLink Client

The CoLink Client is a React application that the user interacts with to send gRPC requests to the CoLink Rust backend.

## Design Overview
![CoLink Frontend Design](frontend_design.png)

The CoLink client receives input from the user and makes HTTP/1.1 calls (i.e. POST requests) to send gRPC requests to the CoLink backend. However, the backend can only accept HTTP/2 calls due to it being a gRPC service. Therefore, an Envoy proxy serves as the translation layer between the two services so neither service needs to consider different protocols.

The `colink-frontend-dev` repository handles the React CoLink Client and the Envoy Proxy configurations.

## Setup (Manual)
### Node.js and npm
Node.js and npm can be installed [here](https://nodejs.org/en/download/). After installation, run `npm install` in the root directory to download all required node packages (protoc, TypeScript, etc).

### Envoy
Envoy can be installed from [here](https://www.envoyproxy.io/docs/envoy/latest/start/install).

## Development

Note: this setup (and other elements of the `README`) assumes that your root directory is setup like such:
```
/CoLearn-Dev
    /colink-frontend-dev
        ...
    /colink-sdk-a-js-dev
        ...
    /colink-server-dev
        /proto
            |
            --- colink.proto
            ...
        ...
```

### Proto Configuration
The CoLink client uses Typescript/Javascript versions of the proto configuration to create/receive gRPC requests. As such, these must be configured before running the service.

Typescript/Javascript definitions of protocol buffers are located in `/proto` generated by the `proto-gen.sh` script file. 

Instructions to update `/proto` definitions:
* In the root directory:
    * Make script executable: `chmod +x ./colink-frontend-dev/proto-gen.sh`
    * Execute script: `./colink-frontend-dev/proto-gen.sh`

### Running the Application (No Setup Script)
This is a 3 step process:
* Start the DDS server core (in `/colink-server-dev`): `cargo run -- --address "127.0.0.1" --port 8080 --mq-amqp amqp://guest:guest@localhost:5672 --mq-api http://guest:guest@localhost:15672/api`
    * Runs on 127.0.0.1:8080 (hard-coded address for now)
    * No TLS support (will include later inside envoy proxy)
* Start the envoy proxy (in `/colink-frontend-dev`): `envoy -c envoy.yaml`
    * Runs on 127.0.0.1:9901 (hard-coded address for now)
* Start react client (in `/colink-frontend-dev`): `npm start`
    * Runs on 127.0.0.1:3000 (hard-coded address for now)

### Running the Application (Setup Script)
This is a 2 step process:
* Start the DDS server core (in `/colink-server-dev`): `cargo run -- --address "127.0.0.1" --port 8080 --mq-amqp amqp://guest:guest@localhost:5672 --mq-api http://guest:guest@localhost:15672/api`
    * Runs on 127.0.0.1:8080 (hard-coded address for now)
    * No TLS support (will include later inside envoy proxy)
* Execute `./start_frontend.sh`
    * This will install any necessary packages and start the frontend UI

For both setups, the frontend UI is hosted at http://localhost:3000

### In Application
* Set the host_token manually in the debug panel before executing any commands (used for user login)
* User Login component allows an individual to create a JWT with their own ECDSA private key or by generating a new private key. Generated credentials are displayed after creation.

## General Layout

### node_modules
Stores node modules used in frontend code

### proto
Typescript/Javascript equivalents of proto configurations

### src
Contains React components + support files for the frontend application (index, App, Login, AdminToken)

### docker-compose.yaml
TBD or removed, potentially wrap all imports in Docker container to avoid extra installation of packages.

### envoy.yaml
Envoy proxy that allows the client application to communicate with the DDS server. The proxy server listens on port 8000 for requests sent by the user and redirects those requests to the DDS server.

### index.html
Entry point for the application.

### *.json, webpack.config.js
Configuration files that support installation + development.